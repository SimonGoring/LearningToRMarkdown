---
title: "Learning to RMarkdown"
author: "Simon Goring"
date: "October 30, 2016"
output: 
  html_document:
    theme: "lumen"
    fig_width: 7
    fig_height: 4
    echo: false
    message: false
    
---

#A brief introduction to Intermediate RMarkdown.

`RMarkdown` is an incredibly poweful platform for developing interactive or static documents that include stylistic elements, but also include elements of analytic code.

RMarkdown effectively pipes a `markdown` document through an R Console, merges the output and then processes it using `pandoc`.  Just as with the R ecosystem itself, as you begin to bring in external packages there is an enormous breadth to the kinds of products you can generate with RMarkdown (see the [RStudio template gallery](http://rmarkdown.rstudio.com/gallery.html)).  From standalone documents, to books, webpages and more, RMarkdown can be an important tool for generating reproducible research in the R environment.

## Getting Started

The first thing to do is to create a new document.  You can edit RMardown files using any kind of editor, as long as the file ends up as a text-based file.  The function that renders RMarkdown into a particular output type is `render` in the `rmarkdown` package, so you can run it from an R console, or from the commandline as:

```bash
Rscript -e "rmarkdown::render('Goring_RmarkdownTutorial.Rmd')"
```

Let's take a look at the `Rmd` file and the output.  I've tried to make this part of the commit history of the GitHub project.  We'll see how well this holds up :)

* [Original `Rmd` file](https://github.com/SimonGoring/LearningToRMarkdown/blob/6d1968dcd4e49c1a2e884813b4c1b9ad5e62a005/Goring_RMarkdownTutorial.Rmd)
* [Original `html` output](http://htmlpreview.github.io/?https://github.com/SimonGoring/LearningToRMarkdown/blob/6d1968dcd4e49c1a2e884813b4c1b9ad5e62a005/Goring_RMarkdownTutorial.html)

So this gives us a good start, but it's only a start.  Your next step is probably to remove all the content and start over.  That was my next step, replacing the content of the RMarkdown template, and replacing it with content up to the end of this introduction.  I'm going to commit it as well and render, so you can see how the HTML and Rmd files change.

## The YAML Header

The first thing you might notice when you look at your new RMarkdown document is a curious set of code separated by a set of dashes.  It looks something like this:

```yaml
---
title: "Learning to RMarkdown"
author: "Simon Goring"
date: "October 30, 2016"
output: html_document
---
```

This is YAML.  YAML is a way of conveying structured information that was developed to be human readable.  While YAML originally meant "*Yet Another Markup Language*", the original authors were computer scientists and so prefered the recursive "*YAML Ain't Markup Language*".  The reason for this is that YAML is not a markup language, it is a way of conveying structured data.  Because YAML uses no braces, only tabs and carriage returns, it is easier for a person to understand.  However, its apparent stylistic simplicity is not limiting.  YAML can pass very complex data structures.

For RMarkdown documents we don't generally need a lot of complexity.  Our first set of edits rendered something that produces [a fairly passable HTML page](http://htmlpreview.github.io/?https://github.com/SimonGoring/LearningToRMarkdown/blob/b88f2cf7bf99612a90ab56769f63396190513108/Goring_RMarkdownTutorial.html).

You can see how the various elements are rendered to HTML.  The key pair `title: "Learning to RMarkdown"` (note that you must always use a space after the colon) is converted to text with the `<title>` tag in HTML.  There is a wack of CSS code, and some `<meta>` tags are declared for document metadata.

There's a surprising amount of extra code in RMarkdown documents.  The raw file at this stage is 600KB of code, which is big for so little (valuable) content.  This is a function of how the `html_document` is generated.  We can change the attributes of the document by modifiying the YAML.

### Nested Lists in YAML

Lets play with different themes.  You can [download this document](https://raw.githubusercontent.com/SimonGoring/LearningToRMarkdown/9e7eecb541e95787aece7ffd62baf840370d2aba/Goring_RMarkdownTutorial.Rmd) and modify the theme by changing the key-pair `output: html_document` to a YAML-type list:

```yaml
---
title: "Learning to RMarkdown"
author: "Simon Goring"
date: "October 30, 2016"
output:
  html_document:
    theme: "lumen"
---
```

By indenting the carriage returns we've created a list.  RMarkdown supports multiple output types.  [My ESA2016 presentation](http://htmlpreview.github.io/?https://github.com/SimonGoring/Hacking_Disciplines-ESA2016_IGN5-4/blob/master/Goring_HackingDisciplines.html) in Mozilla Science R Study Group alumni Andrew MacDonald's Ignite session was generated using `revealjs::revealjs_presentation` as the output type, along with its associated output options.

There are more themes available, along with code highlighting on the [RStudio RMarkdown html_document page](http://rmarkdown.rstudio.com/html_document_format.html#appearance_and_style).

## Chunk Elements

As you continue developing your content you can add in code blocks, source external code, add tables and figures, as we've seen before.

For this section I will read in some content, create a table from the head of the content, and show you how to generate captions.  I'll also add some code options.  One great thing about using the `captioner` package is that is was developed by [Althea Letaw](https://github.com/adletaw), a UBC researcher in the Zoology Department.

```{r, results = "hide", message = FALSE}
library(captioner, quietly = TRUE, verbose = FALSE)

# Initialize our caption types:
figs <- captioner(prefix = "Figure")
tabs <- captioner(prefix = "Table")

library(analogue, quietly = TRUE, verbose = FALSE)
data(abernethy)

figs(name = "bet_pol", "Plot of *Betula* pollen against time from Abernethy Forest in Scotland.")

plot(Betula ~ Age, data = abernethy, type = "b")

```

`r figs("bet_pol")`

This now gives us a figure and a citation for `r figs("bet_pol", display = "cite")`, using the `captioner` package.  There are likely other ways to build the citation, but this works well for me.  The one issue is that there are cases where you may want to generate and reference citations out of order because of coding flow choices.  It may result in unexpected behaviour.

You can change the plotting size in your document by adding `fig_width` and `fig_height` options to the code chunk, but you can also edit your YAML header if you want to maintain consistent heights.

```{r, results = "hide", message = FALSE}
figs(name = "gram_pol", "Plot of Gramineae pollen against time from Abernethy Forest in Scotland.")

plot(Gramineae ~ Age, data = abernethy, type = "b")

```

`r figs("gram_pol")`

Take some time to [download this version](https://github.com/SimonGoring/LearningToRMarkdown/blob/cfbac5f5ec541fbfc8dbff1bc1d9b3c811f38200/Goring_RMarkdownTutorial.Rmd) of the repository and edit the chunks and the YAML header.  Make the figures equal sizes, make then different sizes, try both.  Which over-rides which?

## Styling Your Web Pages

I've now added some elements to the header so my figures are plotted uniformly, what about tables?  There are several ways to print out tables, using raw R, `knitr`'s `kable()` function, or you can use paged HTML tables by modifying the header.

Try these options out on this version of the document, using the following code element:

```{r, results = "hide", echo = FALSE, message = FALSE}
tabs("abe_pln", "Plain table using RMarkdown.")
tabs("abe_knt", "kable table using RMarkdown.")
```

```{r, results = "as-is", echo = FALSE, message = FALSE}

head(abernethy[,1:5])

knitr::kable(head(abernethy[,1:5]))
```

So, you can see how these different versions make differences in the table plotting.  Try changing the header by adding:

```
   df_print: paged
```

to the YAML header.

## Styling your Word Documents

## Adding a Bibliography

